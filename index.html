<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Coaster Gyro HUD Prototype</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"
    />
    <style>
      html,
      body {
        margin: 0;
        height: 100%;
        background: #0b0f14;
        overflow: hidden;
      }
      canvas {
        display: block;
      }

      /* Debug Config panel at bottom-left */
      .ui {
        position: fixed;
        bottom: 12px;
        left: 12px;
        z-index: 10;
        font: 14px/1.3 system-ui, sans-serif;
        color: #cde7ff;
        user-select: none;
        background: rgba(20, 30, 45, 0.6);
        padding: 10px 12px;
        border-radius: 10px;
        backdrop-filter: blur(6px);
        border: 1px solid rgba(120, 170, 220, 0.25);
        max-width: 92vw;
      }
      .ui input[type='number'] {
        width: 80px;
      }
      .ui button {
        font: inherit;
      }

      /* Toggle buttons (bottom-right) */
      .ui-toggle,
      .log-toggle {
        position: fixed;
        right: 12px;
        z-index: 11;
        font: 14px/1.3 system-ui, sans-serif;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid rgba(120, 170, 220, 0.35);
        background: rgba(20, 30, 45, 0.75);
        color: #cde7ff;
        cursor: pointer;
        backdrop-filter: blur(6px);
      }
      .ui-toggle {
        bottom: 12px;
      }
      .log-toggle {
        bottom: 56px;
      } /* stacked above config toggle */

      /* HUD bar */
      .hud {
        position: fixed;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        width: min(66vw, 680px);
        height: 36px;
        z-index: 20;
      }
      .bar {
        position: absolute;
        inset: 0;
        border: 2px solid #fff;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.05);
        overflow: hidden;
      }
      .target {
        position: absolute;
        top: 2px;
        bottom: 2px;
        background: rgba(46, 204, 113, 0.8);
        border: 2px solid rgba(0, 0, 0, 0.15);
        border-radius: 6px;
        transition: width 0.05s linear;
      }
      .needle {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 4px;
        background: #ff4d4d;
        left: 50%;
        transform: translate(-2px, 0);
        box-shadow: 0 0 6px rgba(255, 77, 77, 0.8);
      }

      /* Score + Hearts */
      .meta {
        position: absolute;
        top: 40px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        color: #cde7ff;
        z-index: 20;
        text-shadow: 0 1px 0 rgba(0, 0, 0, 0.4);
      }
      .hearts {
        letter-spacing: 4px;
      }
      .ok {
        filter: drop-shadow(0 0 8px rgba(46, 204, 113, 0.8));
      }

      /* Modal */
      .modal {
        position: fixed;
        inset: 0;
        display: none;
        place-items: center;
        background: rgba(0, 0, 0, 0.5);
        z-index: 50;
      }
      .modal .box {
        background: #0e1522;
        border: 1px solid rgba(150, 200, 255, 0.25);
        border-radius: 12px;
        padding: 24px;
        color: #cde7ff;
        text-align: center;
        width: min(90vw, 380px);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
      }
      .modal .box h2 {
        margin: 0 0 8px;
        font-weight: 700;
      }
      .modal .box button {
        margin-top: 14px;
        font: inherit;
        padding: 10px 14px;
        border-radius: 10px;
        border: 1px solid rgba(120, 170, 220, 0.4);
        background: #14314d;
        color: #cde7ff;
        cursor: pointer;
      }

      /* Damage vignette */
      .vignette {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 40;
        opacity: 0;
        transition: opacity 0.25s ease-out;
        background: radial-gradient(
          ellipse at center,
          rgba(200, 0, 0, 0) 40%,
          rgba(200, 0, 0, 0.35) 70%,
          rgba(150, 0, 0, 0.55) 100%
        );
      }
      .vignette.show {
        opacity: 1;
      }

      /* Landscape overlay (safe-area + dvh) */
      .landscape-overlay {
        position: fixed;
        inset: env(safe-area-inset-top) env(safe-area-inset-right)
          env(safe-area-inset-bottom) env(safe-area-inset-left);
        display: none;
        place-items: center;
        z-index: 1000;
        background: rgba(0, 0, 0, 0.9);
        color: #cde7ff;
        text-align: center;
        padding: 24px;
        max-height: 100dvh;
        overflow: hidden;
        box-sizing: border-box; /* Tambahkan ini untuk konsistensi */
      }
      .landscape-overlay .box {
        box-sizing: border-box; /* Pastikan padding dihitung dalam total lebar */
        background: #0e1522;
        border: 1px solid rgba(150, 200, 255, 0.25);
        border-radius: 12px;
        padding: 24px;
        width: 100%; /* UBAH: Isi ruang yang tersedia di dalam parent */
        max-width: 480px; /* TAMBAHKAN: Batasi lebar maksimum pada layar besar */
        max-height: calc(100dvh - 64px);
        overflow: auto;
      }
      .landscape-overlay button {
        margin-top: 14px;
        font: inherit;
        padding: 10px 14px;
        border-radius: 10px;
        border: 1px solid rgba(120, 170, 220, 0.4);
        background: #14314d;
        color: #cde7ff;
        cursor: pointer;
      }
      @media (orientation: portrait) {
        .landscape-overlay.auto {
          display: grid;
        }
      }

      /* On-screen debug log (hidden by default; toggle shows it) */
      .debuglog {
        position: fixed;
        left: 12px;
        top: 12px;
        z-index: 2000;
        font: 12px/1.35 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        color: #e8f3ff;
        background: rgba(0, 0, 0, 0.55);
        padding: 8px 10px;
        border-radius: 8px;
        max-width: 70vw;
        max-height: 35vh;
        overflow: auto;
        border: 1px solid rgba(150, 200, 255, 0.25);
        display: none;
      }

      /* Global Start Button */
      .global-start-button {
        position: fixed;
        top: 12px;
        right: 12px;
        z-index: 100;
        font: bold 16px/1.3 system-ui, sans-serif;
        padding: 12px 18px;
        border-radius: 10px;
        border: 1px solid rgba(46, 204, 113, 0.7);
        background: rgba(46, 204, 113, 0.85);
        color: #fff;
        cursor: pointer;
        backdrop-filter: blur(6px);
        box-shadow: 0 4px 15px rgba(46, 204, 113, 0.4);
        transition: all 0.2s ease;
      }
      .global-start-button:hover {
        background: rgba(46, 204, 113, 1);
        box-shadow: 0 4px 20px rgba(46, 204, 113, 0.6);
        transform: translateY(-1px);
      }
    </style>
  </head>
  <body>
    <!-- Global Start Button -->
    <button id="startRideGlobal" class="global-start-button">Start Ride</button>

    <!-- HUD -->
    <div class="hud" id="hud">
      <div class="bar" id="bar">
        <div class="target" id="target"></div>
        <div class="needle" id="needle"></div>
      </div>
      <div class="meta">
        <div>Score: <span id="score">0</span></div>
        <div class="hearts" id="hearts">❤❤❤</div>
      </div>
    </div>

    <!-- Debug Config panel -->
    <div class="ui" id="debugConfig">
      <div><b>Debug Config</b></div>
      <div style="margin-top: 6px">
        Duration (s):
        <input id="duration" type="number" min="0.1" step="0.1" value="30" />
        <label style="margin-left: 8px"
          ><input id="loop" type="checkbox" checked /> Loop</label
        >
      </div>
      <div style="margin-top: 6px">
        <button id="start">Start Ride</button>
        <button id="stop">Stop</button>
        <button id="reset">Reset Camera</button>
        <!-- HAPUS: Tombol "Enable Gyro" tidak lagi diperlukan -->
        <button id="center-gyro" style="margin-left: 6px">Center</button>
      </div>
      <div style="margin-top: 6px">
        Gyro Sensitivity:
        <input id="gyro-sense" type="number" step="0.1" min="0" value="1" />
      </div>
      <div style="margin-top: 6px">
        Lead % along path:
        <input
          id="leadT"
          type="number"
          step="0.0005"
          min="0"
          max="1"
          value="0.0025"
        />
      </div>
      <div style="margin-top: 6px">
        Target width (norm 0..1):
        <input
          id="targetWidth"
          type="number"
          step="0.01"
          min="0.02"
          max="1"
          value="0.18"
        />
      </div>
    </div>

    <!-- Toggle buttons -->
    <button id="toggle-ui" class="ui-toggle">Show Config</button>
    <button id="toggle-log" class="log-toggle">Show Log</button>

    <!-- Modal + Vignette -->
    <div class="modal" id="modal">
      <div class="box">
        <h2>Try again</h2>
        <p>Hearts depleted. Want another go?</p>
        <button id="restart">Restart</button>
      </div>
    </div>
    <div class="vignette" id="vignette"></div>

    <!-- Rotate / Landscape overlay -->
    <div id="landscapeOverlay" class="landscape-overlay auto">
      <div class="box">
        <h2>Best viewed in landscape</h2>
        <p id="landscape-instructions">
          Rotate your device. On supported browsers you can also tap “Enter
          Landscape”.
        </p>
        <button id="enterLandscape">Enter Landscape</button>
      </div>
    </div>

    <!-- On-screen debug log (hidden by default) -->
    <pre id="debuglog" class="debuglog"></pre>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
